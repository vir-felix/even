{% layout "_LayoutCheckout" %}
<form method="post" id="form-billing-shipping" action="{% route api_CheckoutAddress %}">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h3>
                    {{"Address" | t}}
                </h3>
                {% if addresses.size > 0 %}
                <select name="BillingAddress.id" class="form-control" id="BillingAddressId">
                    {% for address in addresses %}
                    <option value="{{address.id}}">
                        {{address.name}} {{address.address1}} {{address.address2}} {{address.state}} {{address.city}} {{address.zip}}
                    </option>
                    {% endfor %}
                    <option value="0">
                        {{"New Address..." | t}}
                    </option>
                </select>
                {% endif %}
                {% if shippingRequired %}
                <div id="billing-address-container" class="address-container" {% if addresses.size > 0 %}style="display: none"{% endif %}>
                    {% partial "Addresses/AddressForm" prefix="BillingAddress." %}
                </div>
                {% control checkbox name="UseDifferentShippingAddress" id="UseDifferentShippingAddress" text=@t"Use different address for shipping" value="false" %}
                <div id="delivery-address-container" style="display: none;">
                    <h3>
                        {{"Delivery Address" | t}}
                    </h3>
                    {% if addresses.size > 0 %}
                    <select name="ShippingAddress.id" class="form-control" id="ShippingAddressId">
                        {% for address in addresses %}
                        <option value="{{address.id}}">
                            {{address.name}} {{address.address1}} {{address.address2}} {{address.state}} {{address.city}} {{address.zip}}
                        </option>
                        {% endfor %}
                        <option value="0">
                            {{"New Address..." | t}}
                        </option>
                    </select>
                    {% endif %}
                    <div id="shipping-address-container" class="address-container" {% if addresses.size > 0 %}style="display: none"{% endif %}>
                        {% partial "Addresses/AddressForm" prefix="ShippingAddress." %}
                    </div>
                </div>
                {% endif %}
                <script type="text/javascript">
                    ready(function () {
                        //{% if shippingRequired %}
                        jQuery("#UseDifferentShippingAddress").change(function () {
                            if (jQuery(this).is(":checked")) {
                                jQuery("#delivery-address-container").show();
                            } else {
                                jQuery("#delivery-address-container").hide();
                            }
                        });
                        //{% endif %}
                        jQuery("#BillingAddressId, #ShippingAddressId").change(function () {
                            if (jQuery(this).val() == 0) {
                                jQuery(this).next(".address-container").show();
                            } else {
                                jQuery(this).next(".address-container").hide();
                            }

                        });
                    })
                </script>
            </div>
            <div class="col-md-6">

            </div>
        </div>
        <div class="row">
            <div class="text-center">
                <input type="submit" value="Next" />
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    ready(function() {
        initAjaxForm("form-billing-shipping",
            {
                onSuccess: function() {
                    var paymentInfoUrl = "{% route CheckoutPayment %}";
                    window.location.href = paymentInfoUrl;
                }
            });
    });
</script>
